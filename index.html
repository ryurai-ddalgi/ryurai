<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Îî∏Í∏∞Î•º ÌîºÌï¥Îùº!</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background-color: #ffe0f0;
      font-family: "Arial", sans-serif;
    }

    #game {
      position: relative;
      width: 100vw;
      height: 100vh;
    }

    .character {
      position: absolute;
      font-size: 40px;
      pointer-events: none;
      transition: transform 0.05s linear;
      bottom: 30px; /* Î∞ëÏóêÏÑú Í≥†Ï†ï */
      user-select: none;
    }

    .falling {
      position: absolute;
      font-size: 32px;
      animation-timing-function: linear;
      animation-fill-mode: forwards;
      user-select: none;
    }

    #timer {
      position: absolute;
      top: 10px;
      left: 10px;
      font-size: 18px;
      background: #fff0f7;
      padding: 6px 12px;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      user-select: none;
      z-index: 1000;
    }

    #game-over {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 28px;
      color: #ff4d88;
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
      display: none;
      text-align: center;
      z-index: 1000;
    }

    #restart-button {
      margin-top: 15px;
      background: #ff99bb;
      color: white;
      border: none;
      border-radius: 12px;
      padding: 8px 16px;
      font-size: 16px;
      cursor: pointer;
    }

    #shop-button {
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 18px;
      padding: 6px 12px;
      background: #ff99bb;
      border: none;
      border-radius: 12px;
      color: white;
      cursor: pointer;
      z-index: 1000;
    }

    #shop-modal {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      width: 320px;
      max-width: 90vw;
      max-height: 80vh;
      overflow-y: auto;
      transform: translate(-50%, -50%);
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
      padding: 20px;
      z-index: 2000;
    }

    #shop-modal h2 {
      margin-top: 0;
      margin-bottom: 15px;
      color: #ff4d88;
      text-align: center;
    }

    .item-list {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      justify-content: center;
    }

    .item {
      width: 60px;
      height: 60px;
      border: 2px solid #ff99bb;
      border-radius: 12px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      user-select: none;
      transition: background-color 0.3s;
    }
    .item:hover {
      background-color: #ffe0f0;
    }
    .item.selected {
      border-color: #ff4d88;
      background-color: #ffd1df;
    }
    .item .icon {
      font-size: 30px;
    }
    .item .cost {
      font-size: 12px;
      color: #666;
      margin-top: 4px;
    }

    #close-shop {
      display: block;
      margin: 15px auto 0;
      background: #ff4d88;
      color: white;
      border: none;
      border-radius: 12px;
      padding: 8px 20px;
      font-size: 16px;
      cursor: pointer;
    }

    #strawberry-count {
      position: absolute;
      top: 50px;
      left: 10px;
      font-size: 18px;
      background: #fff0f7;
      padding: 6px 12px;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      user-select: none;
      z-index: 1000;
    }
  </style>
</head>
<body>
  <div id="game">
    <div id="timer">00:00</div>
    <div id="strawberry-count">üçì: 0</div>
    <button id="shop-button">ÏÉÅÏ†ê</button>
    <div id="player" class="character">üë©üèª‚Äçüç≥</div>
    <div id="game-over">
      <div id="game-over-text"></div>
      <button id="restart-button">Îã§Ïãú ÏãúÏûë</button>
    </div>
  </div>

  <div id="shop-modal">
    <h2>ÏÉÅÏ†ê</h2>
    <div>
      <h3>ÏïÑÏù¥ÏΩò</h3>
      <div id="icon-items" class="item-list"></div>
    </div>
    <div style="margin-top: 20px;">
      <h3>Ï∫êÎ¶≠ÌÑ∞</h3>
      <div id="character-items" class="item-list"></div>
    </div>
    <button id="close-shop">Îã´Í∏∞</button>
  </div>

  <script>
    const restartButton = document.getElementById("restart-button");
    const game = document.getElementById("game");
    const player = document.getElementById("player");
    const gameOver = document.getElementById("game-over");
    const gameOverText = document.getElementById("game-over-text");
    const timerDisplay = document.getElementById("timer");
    const strawberryCountDisplay = document.getElementById("strawberry-count");
    const shopButton = document.getElementById("shop-button");
    const shopModal = document.getElementById("shop-modal");
    const closeShopButton = document.getElementById("close-shop");
    const iconItemsContainer = document.getElementById("icon-items");
    const characterItemsContainer = document.getElementById("character-items");

    let startTime = Date.now();
    let gameRunning = true;
    let invincible = false;
    let fallSpeed = 4; // Ï¥àÍ∏∞ ÏÜçÎèÑ Ïú†ÏßÄ
    let objectInterval;
    let timerInterval;
    let paused = false;
    let strawberries = 0;
    let selectedIcon = "üçì";
    let selectedCharacter = "üë©üèª‚Äçüç≥";

    // ÏïÑÏù¥ÌÖú Î™©Î°ù Îç∞Ïù¥ÌÑ∞
    const iconItems = [
      { icon: "üçì", cost: 0 },
      { icon: "üçú", cost: 30 },
      { icon: "üç¶", cost: 50 },
      { icon: "üç≠", cost: 100 },
    ];

    const characterItems = [
      { icon: "üë©üèª‚Äçüç≥", cost: 0 },
      { icon: "üë®üèª‚Äçüç≥", cost: 0 },
      { icon: "üë©üèª‚Äçüî¨", cost: 30 },
      { icon: "üë®üèª‚Äçüî¨", cost: 30 },
      { icon: "üëÆüèª‚Äç‚ôÄÔ∏è", cost: 50 },
      { icon: "üëÆüèª‚Äç‚ôÇÔ∏è", cost: 50 },
      { icon: "üë©üèª‚Äçüéì", cost: 100 },
      { icon: "üë®üèª‚Äçüéì", cost: 100 },
    ];

    // ÌÉÄÏù¥Î®∏ ÏóÖÎç∞Ïù¥Ìä∏
    function updateTimer() {
      if (paused) return;
      const elapsed = Math.floor((Date.now() - startTime) / 1000);
      const minutes = String(Math.floor(elapsed / 60)).padStart(2, '0');
      const seconds = String(elapsed % 60).padStart(2, '0');
      timerDisplay.textContent = `${minutes}:${seconds}`;

      // Îî∏Í∏∞ ÏßÄÍ∏â (45Ï¥àÎßàÎã§ 10Í∞ú)
      if (elapsed > 0 && elapsed % 45 === 0 && strawberries < 10000) {
        strawberries += 10;
        strawberryCountDisplay.textContent = `üçì: ${strawberries}`;
      }
    }

    // Ï∂©Îèå Ï≤¥ÌÅ¨ Ìï®Ïàò
    function isCollision(rect1, rect2) {
      return !(
        rect1.right < rect2.left ||
        rect1.left > rect2.right ||
        rect1.bottom < rect2.top ||
        rect1.top > rect2.bottom
      );
    }

    // Í∞ùÏ≤¥ ÏÉùÏÑ± Ìï®Ïàò
    function createObject() {
      if (!gameRunning || paused) return;

      const obj = document.createElement("div");
      obj.classList.add("falling");

      // ÏàòÎ∞ï ÌôïÎ•† 15~50% ÎûúÎç§
      const watermelonChance = 0.15 + Math.random() * 0.35;
      const isWatermelon = Math.random() < watermelonChance;

      obj.textContent = isWatermelon ? "üçâ" : selectedIcon;
      obj.style.left = Math.random() * (window.innerWidth - 30) + "px";
      obj.style.top = "-50px";
      obj.style.animationDuration = `${4 + Math.random() * 2}s`;

      game.appendChild(obj);

      let posY = -50;
      const speed = fallSpeed + Math.random() * 1.5;

      function fall() {
        if (!gameRunning) {
          obj.remove();
          return;
        }
        if (paused) {
          requestAnimationFrame(fall);
          return;
        }

        posY += speed;
        obj.style.top = posY + "px";

        // Î∞îÎã• ÏßÄÎÇòÍ∞ÄÎ©¥ ÏÇ≠Ï†ú
        if (posY > window.innerHeight) {
          obj.remove();
          return;
        }

        // Ï∂©Îèå Ï≤¥ÌÅ¨
        const playerRect = player.getBoundingClientRect();
        const objRect = obj.getBoundingClientRect();

        if (!invincible && isCollision(playerRect, objRect)) {
          if (isWatermelon) {
            // ÏàòÎ∞ï Ï∂©Îèå Ïãú Î¨¥Ï†Å ÌôúÏÑ± + 5Ï¥àÍ∞Ñ Î¨¥Ï†Å Ïú†ÏßÄ
            invincible = true;
            player.style.opacity = "0.5";
            setTimeout(() => {
              invincible = false;
              player.style.opacity = "1";
            }, 5000);
            obj.remove();
            return;
          } else {
            // Îî∏Í∏∞ Ï∂©Îèå Ïãú Í≤åÏûÑ Ïò§Î≤Ñ
            endGame();
            obj.remove();
            return;
          }
        }

        requestAnimationFrame(fall);
      }

      fall();
    }

    // Í≤åÏûÑ Ïò§Î≤Ñ Ï≤òÎ¶¨
    function endGame() {
      gameRunning = false;
      gameOver.style.display = "block";
      gameOverText.textContent = `Í≤åÏûÑ Ïò§Î≤Ñ! Ï†êÏàò: ${strawberries} Îî∏Í∏∞ üçì`;
    }

    // ÏïÑÏù¥ÌÖú ÏÉùÏÑ± Î∞òÎ≥µ ÏãúÏûë
    function startObjectGeneration() {
      if (objectInterval) clearInterval(objectInterval);
      objectInterval = setInterval(() => {
        if (gameRunning && !paused) createObject();
      }, 500);
    }

    // ÌÉÄÏù¥Î®∏ ÏãúÏûë
    function startTimer() {
      if (timerInterval) clearInterval(timerInterval);
      timerInterval = setInterval(() => {
        updateTimer();
      }, 1000);
    }

    // Í≤åÏûÑ Ïû¨ÏãúÏûë
    function restartGame() {
      // Ï¥àÍ∏∞Ìôî
      strawberries = 0;
      strawberryCountDisplay.textContent = `üçì: ${strawberries}`;
      startTime = Date.now();
      gameRunning = true;
      invincible = false;
      paused = false;
      gameOver.style.display = "none";
      player.style.opacity = "1";
      player.textContent = selectedCharacter;

      // ÌîåÎ†àÏù¥Ïñ¥ ÏúÑÏπò Ï¥àÍ∏∞Ìôî (x: Ï§ëÏïô, y: Î∞ë Í≥†Ï†ï)
      player.style.left = (window.innerWidth / 2 - 20) + "px";
      player.style.bottom = "30px";

      // Îñ®Ïñ¥ÏßÄÎäî Í∞ùÏ≤¥ Î™®Îëê Ï†úÍ±∞
      document.querySelectorAll(".falling").forEach(el => el.remove());

      startObjectGeneration();
      startTimer();
    }

    restartButton.addEventListener("click", () => {
      restartGame();
    });

    // ÏÉÅÏ†ê Ïó¥Í∏∞/Îã´Í∏∞
    shopButton.addEventListener("click", () => {
      paused = true;
      shopModal.style.display = "block";
    });

    closeShopButton.addEventListener("click", () => {
      paused = false;
      shopModal.style.display = "none";
    });

    // ÏïÑÏù¥ÌÖú Î¶¨Ïä§Ìä∏ ÌëúÏãú Î∞è ÏÑ†ÌÉù Í∏∞Îä•
    function renderShopItems() {
      iconItemsContainer.innerHTML = "";
      characterItemsContainer.innerHTML = "";

      iconItems.forEach(item => {
        const div = document.createElement("div");
        div.className = "item";
        if (item.icon === selectedIcon) div.classList.add("selected");
        div.innerHTML = `<div class="icon">${item.icon}</div><div class="cost">${item.cost > 0 ? item.cost + "üçì" : "Î¨¥Î£å"}</div>`;
        div.addEventListener("click", () => {
          if (item.cost > strawberries) {
            alert("Îî∏Í∏∞Í∞Ä Î∂ÄÏ°±Ìï©ÎãàÎã§!");
            return;
          }
          strawberries -= item.cost;
          strawberryCountDisplay.textContent = `üçì: ${strawberries}`;
          selectedIcon = item.icon;
          renderShopItems();
        });
        iconItemsContainer.appendChild(div);
      });

      characterItems.forEach(item => {
        const div = document.createElement("div");
        div.className = "item";
        if (item.icon === selectedCharacter) div.classList.add("selected");
        div.innerHTML = `<div class="icon">${item.icon}</div><div class="cost">${item.cost > 0 ? item.cost + "üçì" : "Î¨¥Î£å"}</div>`;
        div.addEventListener("click", () => {
          if (item.cost > strawberries) {
            alert("Îî∏Í∏∞Í∞Ä Î∂ÄÏ°±Ìï©ÎãàÎã§!");
            return;
          }
          strawberries -= item.cost;
          strawberryCountDisplay.textContent = `üçì: ${strawberries}`;
          selectedCharacter = item.icon;
          player.textContent = selectedCharacter;
          renderShopItems();
        });
        characterItemsContainer.appendChild(div);
      });
    }

    // ÌîåÎ†àÏù¥Ïñ¥ Ïù¥Îèô (ÎßàÏö∞Ïä§ X ÏúÑÏπò Îî∞ÎùºÍ∞ÄÍ∏∞, YÏ∂ï Í≥†Ï†ï)
    window.addEventListener("mousemove", (e) => {
      if (!gameRunning || paused) return;
      // ÌôîÎ©¥ Í≤ΩÍ≥Ñ ÎÑòÏßÄ ÏïäÎèÑÎ°ù Í≥ÑÏÇ∞ (Í∞ÄÎ°ú)
      const playerWidth = player.offsetWidth;
      let newX = e.clientX - playerWidth / 2;
      if (newX < 0) newX = 0;
      if (newX > window.innerWidth - playerWidth) newX = window.innerWidth - playerWidth;
      player.style.left = newX + "px";
      // YÏ∂ïÏùÄ Í≥†Ï†ï (ÏïÑÎûòÏ™Ω)
      player.style.bottom = "30px";
    });

    // ÏãúÏûë Ïãú Ï¥àÍ∏∞Ìôî
    window.onload = () => {
      restartGame();
      renderShopItems();
    };
  </script>
</body>
</html>
